<script>
  async function analyze() {
    const message = document.getElementById('conversation').value;
    const resultBox = document.getElementById('result');
    resultBox.textContent = '‚è≥ –ì–µ–Ω–µ—Ä–∏—Ä—É—é –æ—Ç–≤–µ—Ç...';

    try {
      const res = await fetch('/api/analyze', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message })
      });

      const data = await res.json();

      console.log('üì¶ –û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', data);

      if (data.reply) {
        resultBox.textContent = data.reply;
      } else if (data.error) {
        resultBox.textContent = `‚ùå –û—à–∏–±–∫–∞: ${data.error}`;
      } else {
        resultBox.textContent = '‚ö†Ô∏è –û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω, –Ω–æ –ø—É—Å—Ç–æ–π.';
      }
    } catch (err) {
      resultBox.textContent = `üö® JS –æ—à–∏–±–∫–∞: ${err.message}`;
    }
  }
</script>
