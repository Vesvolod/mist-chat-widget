<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Mist ChatGPT Kommo Widget</title>
</head>
<body>
  <h3>Mist Jarvis: AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è Kommo</h3>

  <textarea id="conversation" rows="10" cols="70" placeholder="–í—Å—Ç–∞–≤—å –ø–µ—Ä–µ–ø–∏—Å–∫—É –∫–ª–∏–µ–Ω—Ç–∞..."></textarea><br>
  <button id="analyzeButton">–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>

  <h4>üåê –Ø–∑—ã–∫:</h4>
  <pre id="lang"></pre>

  <h4>üìä –ê–Ω–∞–ª–∏–∑:</h4>
  <pre id="analysis"></pre>

  <h4>üí¨ –û—Ç–≤–µ—Ç –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞:</h4>
  <pre id="reply"></pre>

  <h4>üìà –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º:</h4>
  <pre id="recommendation"></pre>

  <script>
    document.getElementById('analyzeButton').addEventListener('click', analyze);

    async function analyze() {
      const message = document.getElementById('conversation').value;

      document.getElementById('lang').textContent = '‚è≥...';
      document.getElementById('analysis').textContent = '';
      document.getElementById('reply').textContent = '';
      document.getElementById('recommendation').textContent = '';

      try {
        const res = await fetch('/api/analyze', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message })
        });

        const data = await res.json();

        document.getElementById('lang').textContent = data.language || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω';
        document.getElementById('analysis').textContent = data.analysis || '‚Äì';
        document.getElementById('reply').textContent = data.reply || '‚Äì';
        document.getElementById('recommendation').textContent = data.sales_recommendation || '‚Äì';
      } catch (err) {
        document.getElementById('lang').textContent = `–û—à–∏–±–∫–∞: ${err.message}`;
      }
    }
  </script>
</body>
</html>
