<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Mist ChatGPT Kommo Widget Test</title>
</head>
<body>
  <h3>Mist ChatGPT Kommo Widget Test</h3>

  <textarea id="conversation" rows="10" cols="70" placeholder="–í—Å—Ç–∞–≤—å –ø–µ—Ä–µ–ø–∏—Å–∫—É"></textarea><br>
  <button id="analyzeButton">–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>

  <pre id="result"></pre>

  <script>
    document.getElementById('analyzeButton').addEventListener('click', analyze);

    async function analyze() {
      const message = document.getElementById('conversation').value;
      const resultBox = document.getElementById('result');
      resultBox.textContent = '‚è≥ –ì–µ–Ω–µ—Ä–∏—Ä—É—é –æ—Ç–≤–µ—Ç...';

      try {
        const res = await fetch('/api/analyze', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message })
        });

        const data = await res.json();
        console.log('üì¶ –û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', data);

        if (data.reply) {
          resultBox.textContent = data.reply;
        } else if (data.error) {
          resultBox.textContent = `‚ùå –û—à–∏–±–∫–∞: ${data.error}`;
        } else {
          resultBox.textContent = '‚ö†Ô∏è –û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω, –Ω–æ –ø—É—Å—Ç–æ–π.';
        }
      } catch (err) {
        resultBox.textContent = `üö® JS –æ—à–∏–±–∫–∞: ${err.message}`;
      }
    }
  </script>
</body>
</html>
